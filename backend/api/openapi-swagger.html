<!DOCTYPE html>
<html lang="ru">
<head>
    <title>BooBook API Documentation - Swagger UI</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="REST API документация для системы управления библиотекой BooBook">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui.css" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        body {
            margin: 0;
            background: #fafafa;
        }
        .error-message {
            display: none;
            padding: 20px;
            margin: 20px;
            background: #ffebee;
            border-left: 4px solid #d32f2f;
            color: #d32f2f;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .error-message h3 {
            margin-top: 0;
        }
        .error-message pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .error-message a {
            color: #1976d2;
            text-decoration: none;
        }
        .error-message a:hover {
            text-decoration: underline;
        }
        #swagger-ui {
            display: block;
        }
        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 18px;
            color: #333;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: #fafafa;
            z-index: 1000;
        }
        .loading.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div>Загрузка документации...</div>
        <div style="font-size: 14px; margin-top: 10px; color: #666;">
            Пожалуйста, подождите
        </div>
    </div>
    <div class="error-message" id="error">
        <h3>⚠️ Ошибка загрузки API документации</h3>
        <p>Для просмотра документации необходимо запустить локальный HTTP сервер, так как браузер блокирует загрузку локальных файлов из соображений безопасности.</p>
        <p><strong>Решение:</strong></p>
        <pre>cd backend/api
./serve-docs.sh</pre>
        <p>Или вручную:</p>
        <pre>cd backend/api
python3 -m http.server 8081</pre>
        <p>Затем откройте в браузере:</p>
        <p><a href="http://localhost:8081/openapi-swagger.html" target="_blank">http://localhost:8081/openapi-swagger.html</a></p>
        <p><strong>Альтернативные варианты:</strong></p>
        <ul>
            <li>Откройте <a href="https://editor.swagger.io/" target="_blank">Swagger Editor</a> и импортируйте файл openapi.yaml</li>
            <li>Используйте онлайн версию: <a href="https://petstore.swagger.io/" target="_blank">Swagger UI Demo</a> и загрузите openapi.yaml</li>
        </ul>
    </div>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            // Используем простой подход - Swagger UI сам загрузит и распарсит YAML
            const ui = SwaggerUIBundle({
                url: "openapi.yaml",
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                validatorUrl: null,
                docExpansion: "list",
                filter: true,
                showExtensions: true,
                showCommonExtensions: true,
                tryItOutEnabled: true,
                supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
                oauth2RedirectUrl: window.location.origin + "/oauth2-redirect.html",
                onComplete: function() {
                    // Успешная загрузка
                    console.log('Swagger UI загружен успешно');
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('error').style.display = 'none';
                },
                onFailure: function(data) {
                    // Ошибка загрузки
                    console.error('Swagger UI ошибка:', data);
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('error').style.display = 'block';
                }
            });

            // Таймаут на случай если загрузка зависла
            setTimeout(function() {
                const loading = document.getElementById('loading');
                const swaggerElement = document.getElementById('swagger-ui');
                
                // Проверяем, загрузился ли Swagger UI
                if (loading && !loading.classList.contains('hidden')) {
                    // Проверяем наличие контента в swagger-ui
                    if (swaggerElement && swaggerElement.children.length > 0) {
                        // Контент есть, скрываем загрузку
                        loading.classList.add('hidden');
                    } else {
                        // Контента нет, показываем ошибку
                        loading.classList.add('hidden');
                        document.getElementById('error').style.display = 'block';
                    }
                }
            }, 10000); // Увеличиваем таймаут до 10 секунд для больших файлов
        };
    </script>
</body>
</html>
